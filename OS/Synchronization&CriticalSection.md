## 동기화(Synchronization)
- `레이스 컨디션` 상황을 막기 위해 프로세스/스레드들에 하나의 자원에 대한 처리 `권한`을 주거나 `순서`를 조정해주는 기법이다. 
- `다중 스레드` 환경에 공유되는 자원이 있다면 필수적으로 고려해야한다. 
- 프로세스의 경우 OS 레벨에서 공유 자원 문제를 처리해주지만 한 프로세스 내에서 실행되는 여러 개의 스레드들은 공유 자원에 대해 동기화 문제를 고려해야한다. 
- 스레드 동기화는 모니터(`Monitor`)와 세마포어(`Semaphore`)로 구성된다.
- 사용하는 시스템이나 언어에서 `어느쪽을 지원`하는지에 따라 선택해서 사용한다. 
    - Java는 기본적으로 모니터를 지원한다.
- 스레드 동기화는 공유 자원에 접근하기 위해 자물쇠의 획득과 해제에 비용이 든다. 따라서 라이브러리를 별도로 만드는 편이다.
    - ex) Java의 `StringBuffer`, `StringBuilder`

### 모니터(Monitor)
- 상호 배제 자물쇠(mutual exclusion lock)로 보호되는 루틴의 집합을 일컬음
- 자물쇠를 획득하기 전까지 모니터에 속하는 루틴을 실행할 수 없다. 
- 즉 한 모니터에 한 스레드씩 실행되며, 다른 스레드들은 실행중인 스레드가 자물쇠를 놓아줄 때까지 기다려야한다. 
- 모니터에 속하는 스레드가 다른 이벤트 발생을 기다리기 위해 스스로 멈추면 다른 스레드가 모니터로 진입할 수 있다. 
- 대기중인 스레드가 이벤트가 발생했다는 연락을 받으면 스레드가 깨어나서 자물쇠를 재획득하게 된다.

### 세마포어(Semaphore)
- 세마포어는 모니터와 비슷하지만 더 간단하다.
- 공유 자원을 보호하기 위한 자물쇠만 있다. 
- 스레드에서 공유자원을 사용하기 위해 자물쇠를 획득해야한다.
- 자물쇠를 쥐고 있는 스레드에서 놓아주기 전까지 그 자원을 획득하려는 스레드는 막히게된다.
- 자물쇠를 놓아주는 순간 자물쇠를 획득하려고 대기하던 스레드가 그 자물쇠를 획득한다.
- 가장 기본적인 방식의 세마포어를 상호 배제(mutual exclusion, 줄여서 뮤텍스 mutex라 부름) 세마포어라 한다. 

### 모니터와 세마포어의 차이
- 모니터가 자물쇠의 획득과 해제를 모두 자동으로 처리해줘서 쓰기에 간단하다.
- 세마포어는 획득한 자물쇠를 해제하는 작업을 일일이 해줘야한다. 

### 경쟁 상황(레이스 컨디션, Race Condition) 
- `공유 자원`에 여러 프로세스/스레드가 동시에 접근하기 위해 `경쟁`하는 상태를 뜻한다.
    - ex) OS에서 CPU 점유율 등 
- `동기화 처리`를 제대로 하지 않으면 의도하지 않은 잘못된 결과가 나올 수 있다. 

## 임계 영역(Critical Section)
- `공유 자원`에 `접근`하는 프로세스 내부의 코드 영역.
- 한 프로세스의 임계 영역이 수행 중일 때 다른 프로세스가 같은 공유 자원을 사용하는 임계 영역을 수행한다면 문제가 발생할 수 있다.
- 따라서 한 번에 한 프로세스만 접근해 사용한다.
- 임계 영역을 들어오는 진입 영역(entry section), 나가는 부분인 퇴출 영역(exit section), 나머지 영역(remainder section)으로 구분된다. 

## 임계 영역의 조건
### 상호 배제(Mutual Exclusion( == Mutex))
- 한 프로세스가 자신의 임계 영역 내에서 실행되는 동안, 다른 프로세스가 같은 공유 자원을 사용하는 자신의 임계 영역에서 실행될 수 없는 것.

### 진행 (Progress)
- 임계 영역을 실행 중인 프로세스가 없고 자신의 임계 영역으로 진입하려는 프로세스가 있다면, 나머지 영역에서 실행 중이지 않은 프로세스들만 임계 영역으로 진입하기 위해 요청할 수 있다.
- 이는 무기한 연기될 수 없다.

### 한정된 대기 (Bounded waiting)
- 프로세스가 자신의 임계 영역에 진입하기 위해 요청을 한 뒤, 그 요청이 허가될 때까지 다른 프로세스들이 자신의 임계 영역에 진입하도록 허용하는 횟수의 제한이 있어야한다. 

## 임계 영역 해결 방안(동기화)
- 하드웨어 기반 동기화와 소프트웨어 기반 동기화로 나뉜다.
- 대표적인 소프트웨어 기반 동기화 기법으로 상호 배제(`Mutex`), 세마포어(`Semaphore`), 모니터(`Monitor`) 등이 있다.

> [전문](https://kodakyung.github.io/2019/07/17/OS-%EB%8F%99%EA%B8%B0%ED%99%94-Synchronization-%EC%99%80-%EC%9E%84%EA%B3%84-%EC%98%81%EC%97%AD-Critical-Section/)