!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(k){var t={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},y=k.Pos;function S(e,r){return"pairs"==r&&"string"==typeof e?e:"object"==typeof e&&null!=e[r]?e[r]:t[r]}k.defineOption("autoCloseBrackets",!1,function(e,r,t){t&&t!=k.Init&&(e.removeKeyMap(i),e.state.closeBrackets=null),r&&(n(S(r,"pairs")),e.state.closeBrackets=r,e.addKeyMap(i))});var i={Backspace:function(e){var r=O(e);if(!r||e.getOption("disableInput"))return k.Pass;for(var t=S(r,"pairs"),n=e.listSelections(),i=0;i<n.length;i++){if(!n[i].empty())return k.Pass;var a=s(e,n[i].head);if(!a||t.indexOf(a)%2!=0)return k.Pass}for(var i=n.length-1;0<=i;i--){var o=n[i].head;e.replaceRange("",y(o.line,o.ch-1),y(o.line,o.ch+1),"+delete")}},Enter:function(n){var e=O(n),r=e&&S(e,"explode");if(!r||n.getOption("disableInput"))return k.Pass;for(var i=n.listSelections(),t=0;t<i.length;t++){if(!i[t].empty())return k.Pass;var a=s(n,i[t].head);if(!a||r.indexOf(a)%2!=0)return k.Pass}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null),n.execCommand("goCharLeft"),i=n.listSelections();for(var r=0;r<i.length;r++){var t=i[r].head.line;n.indentLine(t,null,!0),n.indentLine(t+1,null,!0)}})}};function n(e){for(var r=0;r<e.length;r++){var t=e.charAt(r),n="'"+t+"'";i[n]||(i[n]=a(t))}}function a(r){return function(e){return function(i,e){var r=O(i);if(!r||i.getOption("disableInput"))return k.Pass;var t=S(r,"pairs"),n=t.indexOf(e);if(-1==n)return k.Pass;for(var a,o=S(r,"closeBefore"),s=S(r,"triples"),l=t.charAt(n+1)==e,c=i.listSelections(),f=n%2==0,h=0;h<c.length;h++){var u,d=c[h],p=d.head,g=i.getRange(p,y(p.line,p.ch+1));if(f&&!d.empty())u="surround";else if(!l&&f||g!=e)if(l&&1<p.ch&&0<=s.indexOf(e)&&i.getRange(y(p.line,p.ch-2),p)==e+e){if(2<p.ch&&/\bstring/.test(i.getTokenTypeAt(y(p.line,p.ch-2))))return k.Pass;u="addFour"}else if(l){var v=0==p.ch?" ":i.getRange(y(p.line,p.ch-1),p);if(k.isWordChar(g)||v==e||k.isWordChar(v))return k.Pass;u="both"}else{if(!f||!(0===g.length||/\s/.test(g)||-1<o.indexOf(g)))return k.Pass;u="both"}else u=!l||(b=p,void 0,C=(m=i).getTokenAt(y(b.line,b.ch+1)),!/\bstring/.test(C.type)||C.start!=b.ch||0!=b.ch&&/\bstring/.test(m.getTokenTypeAt(b)))?0<=s.indexOf(e)&&i.getRange(p,y(p.line,p.ch+3))==e+e+e?"skipThree":"skip":"both";if(a){if(a!=u)return k.Pass}else a=u}var m,b,C;var x=n%2?t.charAt(n-1):e,P=n%2?e:t.charAt(n+1);i.operation(function(){if("skip"==a)i.execCommand("goCharRight");else if("skipThree"==a)for(var e=0;e<3;e++)i.execCommand("goCharRight");else if("surround"==a){for(var r=i.getSelections(),e=0;e<r.length;e++)r[e]=x+r[e]+P;i.replaceSelections(r,"around"),r=i.listSelections().slice();for(var e=0;e<r.length;e++)r[e]=(t=r[e],void 0,n=0<k.cmpPos(t.anchor,t.head),{anchor:new y(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new y(t.head.line,t.head.ch+(n?1:-1))});i.setSelections(r)}else"both"==a?(i.replaceSelection(x+P,null),i.triggerElectric(x+P),i.execCommand("goCharLeft")):"addFour"==a&&(i.replaceSelection(x+x+x+x,"before"),i.execCommand("goCharRight"));var t,n})}(e,r)}}function O(e){var r=e.state.closeBrackets;return!r||r.override?r:e.getModeAt(e.getCursor()).closeBrackets||r}function s(e,r){var t=e.getRange(y(r.line,r.ch-1),y(r.line,r.ch+1));return 2==t.length?t:null}n(t.pairs+"`")});